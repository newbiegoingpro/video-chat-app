(this["webpackJsonpvideo-chat"]=this["webpackJsonpvideo-chat"]||[]).push([[0],{41:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),i=n(28),o=n.n(i),u=(n(41),n(1)),a=n(18),s=n.n(a),f=n(26),l=n(29),d=n(36),j=n(10),O=n(8),p=n.n(O),b=n(35),h=Object(b.a)("http://localhost:3001",{"force new connections":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]}),E=function(e){var t=Object(r.useState)(e),n=Object(j.a)(t,2),c=n[0],i=n[1],o=Object(r.useRef)(null),u=Object(r.useCallback)((function(e,t){o.current=t,i((function(t){return"function"===typeof e?e(t):e}))}),[]);return Object(r.useEffect)((function(){o.current&&(o.current(c),o.current=null)}),[c]),[c,u]},v=n(33),x=n.n(v),m="LOCAL_VIDEO";var D=n(2);function I(){var e=function(e){var t=E([]),n=Object(j.a)(t,2),c=n[0],i=n[1],o=Object(r.useCallback)((function(e,t){c.includes(e)||i((function(t){return[].concat(Object(d.a)(t),[e])}),t)}),[c,i]),u=Object(r.useRef)({}),a=Object(r.useRef)(null),O=Object(r.useRef)(Object(l.a)({},m,null));Object(r.useEffect)((function(){function e(){return(e=Object(f.a)(s.a.mark((function e(t){var n,r,c,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerID,r=t.createOffer,!(n in u.current)){e.next=3;break}return e.abrupt("return",console.warn("Already connected to peer ".concat(n)));case 3:if(u.current[n]=new RTCPeerConnection({iceServers:x()()}),u.current[n].onicecandidate=function(e){e.candidate&&h.emit(p.a.RELAY_ICE,{peerID:n,iceCandidate:e.candidate})},c=0,u.current[n].ontrack=function(e){var t=Object(j.a)(e.streams,1)[0];2===++c&&o(n,(function(){O.current[n]?O.current[n].srcObject=t:setTimeout((function(){O.current[n].srcObject=t}),1e3)}))},a.current.getTracks().forEach((function(e){u.current[n].addTrack(e,a.current)})),!r){e.next=15;break}return e.next=11,u.current[n].createOffer();case 11:return i=e.sent,e.next=14,u.current[n].setLocalDescription(i);case 14:h.emit(p.a.RELAY_SDP,{peerID:n,sessionDescription:i});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return h.on(p.a.ADD_PEER,(function(t){return e.apply(this,arguments)})),function(){h.off(p.a.ADD_PEER)}}),[]),Object(r.useEffect)((function(){function e(){return(e=Object(f.a)(s.a.mark((function e(t){var n,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.peerID,r=t.sessionDescription,e.next=3,u.current[n].setRemoteDescription(new RTCSessionDescription(r));case 3:if("offer"!==r.type){e.next=10;break}return e.next=6,u.current[n].createAnswer();case 6:return c=e.sent,e.next=9,u.current[n].setLocalDescription(c);case 9:h.emit(p.a.RELAY_SDP,{peerID:n,sessionDescription:c});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return h.on(p.a.SESSION_DESCRIPTION,(function(t){return e.apply(this,arguments)})),function(){h.off(p.a.SESSION_DESCRIPTION)}}),[]),Object(r.useEffect)((function(){return h.on(p.a.ICE_CANDIDATE,(function(e){var t,n=e.peerID,r=e.iceCandidate;null===(t=u.current[n])||void 0===t||t.addIceCandidate(new RTCIceCandidate(r))})),function(){h.off(p.a.ICE_CANDIDATE)}}),[]),Object(r.useEffect)((function(){return h.on(p.a.REMOVE_PEER,(function(e){var t=e.peerID;u.current[t]&&u.current[t].close(),delete u.current[t],delete O.current[t],i((function(e){return e.filter((function(e){return e!==t}))}))})),function(){h.off(p.a.REMOVE_PEER)}}),[]),Object(r.useEffect)((function(){function t(){return(t=Object(f.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:720,height:480}});case 2:a.current=e.sent,o(m,(function(){var e=O.current.LOCAL_VIDEO;e&&(e.volume=0,e.srcObject=a.current)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){return t.apply(this,arguments)}().then((function(){return h.emit(p.a.JOIN,{room:e})})).catch((function(e){return console.error("Error getting userMedia:",e)})),function(){a.current.getTracks().forEach((function(e){return e.stop()})),h.emit(p.a.LEAVE)}}),[e]);var b=Object(r.useCallback)((function(e,t){O.current[e]=t}),[]);return{clients:c,provideMediaRef:b}}(Object(u.g)().id),t=e.clients,n=e.provideMediaRef;console.log(t);var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=Array.from({length:e}).reduce((function(e,t,n,r){return n%2===0&&e.push(r.slice(n,n+2)),e}),[]),n=t.length,r="".concat(100/n,"%");return t.map((function(e,t,n){return t===n.length-1&&1===e.length?[{width:"100%",heigth:r}]:e.map((function(){return{width:"50%",heigth:r}}))})).flat()}(t.length);return Object(D.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",height:"100vh"},children:t.map((function(e,t){return Object(D.jsx)("div",{style:c[t],children:Object(D.jsx)("video",{width:"100%",height:"100%",autoPlay:!0,playsInline:!0,muted:e===m,ref:function(t){n(e,t)}})},e)}))})}var R=n(54);function C(){var e=c.a.useState([]),t=Object(j.a)(e,2),n=t[0],r=t[1],i=Object(u.f)(),o=c.a.useRef();return c.a.useEffect((function(){h.on(p.a.SHARE_ROOMS,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.rooms,n=void 0===t?[]:t;o.current&&r(n)}))}),[]),Object(D.jsxs)("div",{ref:o,children:["Main",Object(D.jsx)("h1",{children:"Rooms"}),Object(D.jsx)("ul",{children:n.map((function(e){return Object(D.jsxs)("li",{children:[e,Object(D.jsx)("button",{onClick:function(){i("/room/".concat(e))},children:"join"})]},e)}))}),Object(D.jsx)("button",{onClick:function(){i("/room/".concat(Object(R.a)()))},children:"create new room"})]})}function A(){return Object(D.jsx)("div",{children:"NotFound"})}var S=n(34);var g=function(){return Object(D.jsx)(S.a,{children:Object(D.jsxs)(u.c,{children:[Object(D.jsx)(u.a,{exact:!0,path:"/",element:Object(D.jsx)(C,{})}),Object(D.jsx)(u.a,{exact:!0,path:"/room/:id",element:Object(D.jsx)(I,{})}),Object(D.jsx)(u.a,{path:"*",element:Object(D.jsx)(A,{})})]})})};o.a.render(Object(D.jsx)(c.a.StrictMode,{children:Object(D.jsx)(g,{})}),document.getElementById("root"))},8:function(e,t){e.exports={JOIN:"join",LEAVE:"leave",ADD_PEER:"add-peer",REMOVE_PEER:"remove-peer",SHARE_ROOMS:"share-room",RELAY_SDP:"relay-sdp",RELAY_ICE:"relay-ice",ICE_CANDIDATE:"ice-candidate",SESSION_DESCRIPTION:"session-description"}}},[[52,1,2]]]);
//# sourceMappingURL=main.c8ab48de.chunk.js.map